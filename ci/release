#!/bin/bash

set -xe

# We can deploy only when a tag is pushed, and use ir as the version
VERSION="${TRAVIS_BRANCH}-${TRAVIS_COMMIT:0:7}"

curl -L http://github.com/micha/jsawk/raw/master/jsawk > jsawk
chmod 755 jsawk

#Â update in-place
mkfifo pipe
cat ci/bintray.json | ./jsawk "this.version.name = '$VERSION'" > pipe &
cat < pipe > ci/bintray.json
rm pipe

make release

